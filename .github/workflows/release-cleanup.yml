name: Release cleanup
on:
  release:
    types:
      - published
  push:
    branches:
      - release/*
jobs:
  change-namespace:
    name: Change namespace
    runs-on: ubuntu-latest
    steps:
      - name: Git checkout
        uses: actions/checkout@v3
      #- name: Git fetch
      #  run: git fetch --all
      - run: pwd
      - run: ls -la
      - name: Rename abchc to minecraft_but.core
        run: mv ./data/abchc ./data/minecraft_but.core
      - name: Set .gitignore to release .gitignore
        run: mv ./.gitignores/release .gitignore
      - name: Delete ignored files
        run: |
          git branch
          date > generated.txt
          git config user.name github-actions
          git config user.email github-actions@github.com
          git rm -r --cached .
      - name: Search & replace
        run: |
          find . -type f -name "*.mcfunction" -not -path ".git"  -print0 | xargs -0 sed -i'' -e 's/abchc/minecraft_but.core/g'
          find . -type f -name ".mcfunction" -not -path ".git"  -print0 | xargs -0 sed -i'' -e 's/abch/minecraft_but/g'

          find . -type f -name "*.js" -not -path ".git"  -print0 | xargs -0 sed -i'' -e 's/abchc/minecraft_but.core/g'
          find . -type f -name "*.js" -not -path ".git"  -print0 | xargs -0 sed -i'' -e 's/abch/minecraft_but/g'

          find . -type f -name "*.json" -not -path ".git"  -print0 | xargs -0 sed -i'' -e 's/abchc/minecraft_but.core/g'
          find . -type f -name "*.json" -not -path ".git"  -print0 | xargs -0 sed -i'' -e 's/abch/minecraft_but/g'

          find . -type f -name "*.mjs" -not -path ".git"  -print0 | xargs -0 sed -i'' -e 's/abchc/minecraft_but.core/g'
          find . -type f -name "*.mjs" -not -path ".git"  -print0 | xargs -0 sed -i'' -e 's/abch/minecraft_but/g'

          find . -type f -name "*.cjs" -not -path ".git"  -print0 | xargs -0 sed -i'' -e 's/abchc/minecraft_but.core/g'
          find . -type f -name "*.cjs" -not -path ".git"  -print0 | xargs -0 sed -i'' -e 's/abch/minecraft_but/g'
      - name: Debug - ls
        run: ls -lah ./data
      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "GitHub Action: Clean for release"
